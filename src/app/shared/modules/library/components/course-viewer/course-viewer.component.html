<ng-container *ngIf="course">
	<mat-drawer-container
		class="h-full w-full"
		autosize
		*ngIf="course.order < 3 || hasValidSubscription; else unauthorizedLesson">
		<mat-drawer
			#drawer
			class="w-60 p-4 !flex flex-col justify-start items-start"
			mode="side"
			opened>
			<h2 class="text-2xl" [style]="'color:' + course.color">
				{{
					'modules.library.viewer.progress.week'
						| translate: {number: (course.order + 1).toFixed()}
				}}
			</h2>
			<mat-chip-listbox class="mb-2" aria-label="File selection">
				<mat-chip-option
					*ngFor="let phoneme of course.phonemes"
					selectable="false"
					color="primary">
					{{ phoneme.name }}
				</mat-chip-option>
			</mat-chip-listbox>
			<app-button
				*ngIf="course.order >= currentUserLesson; else completedCourse"
				type="raised"
				color="primary"
				(click)="setCurrentLesson(course.order + 1)"
				label="modules.library.viewer.mark_as_finished" />
			<ng-template #completedCourse>
				<app-message
					summary="modules.library.viewer.completed_course"
					severity="note" />
				<app-button
					type="stroked"
					color="primary"
					label="modules.library.viewer.back_to_course"
					(click)="setCurrentLesson(course.order)" />
			</ng-template>

			<hr class="my-3" />

			<h3 class="text-xl !mb-1">
				{{ 'modules.library.viewer.words_list' | translate }}
			</h3>
			<mat-chip-listbox
				*ngIf="course.words?.length; else noWordsAssociated"
				class="mb-2"
				aria-label="File selection">
				<mat-chip-option
					*ngFor="let word of course.words"
					selectable="false"
					color="primary">
					{{ word }}
				</mat-chip-option>
			</mat-chip-listbox>
			<ng-template #noWordsAssociated>
				<app-message
					[showIcon]="false"
					summary="modules.library.viewer.no_word_associated"
					severity="warn" />
			</ng-template>
			<hr class="mb-6" />
			<h3 class="text-xl">
				{{ 'modules.library.viewer.files_list' | translate }}
			</h3>
			<mat-selection-list #files [multiple]="false">
				<mat-list-option
					*ngFor="let file of filesAvailable"
					[value]="file"
					[selected]="file === filesAvailable[0]">
					{{ 'modules.library.files.' + file | translate }}
				</mat-list-option>
			</mat-selection-list>
			<span class="flex-1"></span>
		</mat-drawer>
		<app-file-viewer
			*ngIf="files.selectedOptions.selected[0] as selectedFile"
			[file]="[course.order, selectedFile.value].join('/')" />
	</mat-drawer-container>
	<ng-template #unauthorizedLesson>
		<app-card
			class="mt-6 max-w-md"
			title="core.api.status.403"
			subtitle="modules.library.viewer.restricted_lesson">
			<img src="assets/img/access-denied.gif" alt="access-denied" />
			<p class="text-lg text-primary" translated>
				{{ 'modules.library.viewer.sub_to_access' | translate }}
			</p>
			<app-button
				type="raised"
				class="mt-3"
				label="modules.subscription.see_sub" />
		</app-card>
	</ng-template>
</ng-container>
