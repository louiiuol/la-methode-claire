<ng-container *ngIf="course">
	<mat-drawer-container
		class="h-full w-full"
		autosize
		*ngIf="course.order < 3 || hasValidSubscription; else unauthorizedLesson">
		<mat-drawer
			#drawer
			class="w-60 px-4 !flex flex-col justify-start items-start"
			[mode]="platform.isMobileView() ? 'over' : 'side'"
			opened>
			<h2 class="text-2xl my-2" [style]="'color:' + course.color">
				Semaine N°{{ (course.order + 1).toFixed() }}
				<app-icon></app-icon>
			</h2>
			<div
				class="mb-2 flex gap-3 items-center justify-start"
				*ngIf="course.order < currentUserLesson; else onGoingCourse">
				<span
					class="px-2 py-1 bg-green-400 text-white rounded-md w-fit text-sm italic">
					Terminée
				</span>

				<app-icon
					class="cursor-pointer !mx-0"
					color="accent"
					(click)="setCurrentLesson(course.order)"
					matTooltip="Revenir à cette leçon">
					restart_alt
				</app-icon>
			</div>
			<ng-template #onGoingCourse>
				<ng-container
					*ngIf="course.order > currentUserLesson; else pendingCourse">
					<div class="mb-2 flex gap-3 items-center justify-start">
						<span
							class="px-2 py-1 bg-slate-300 text-gray-700 rounded-md w-fit text-sm italic">
							En attente
						</span>

						<app-icon
							class="cursor-pointer !mx-0"
							color="accent"
							(click)="setCurrentLesson(course.order)"
							matTooltip="Passer à cette leçon">
							restart_alt
						</app-icon>
					</div>
				</ng-container>
				<ng-template #pendingCourse>
					<div class="mb-2 flex gap-3 items-center justify-start">
						<span
							class="px-2 py-1 bg-primary text-white rounded-md w-fit text-sm italic">
							En cours
						</span>

						<app-icon
							class="cursor-pointer !mx-0"
							(click)="setCurrentLesson(course.order + 1)"
							matTooltip="Marquer comme terminée">
							check
						</app-icon>
					</div>
				</ng-template>
			</ng-template>

			<hr class="my-3" />

			<h3 class="text-sm italic !mb-1">Phonème(s) associé(s)</h3>
			<p class="text-primary">
				<span *ngFor="let phoneme of course.phonemes" class="mx-1">
					{{ phoneme.name }}
				</span>
			</p>

			<hr class="my-3" />

			<h3 class="text-sm italic !mb-1">Liste des mot(s)</h3>
			<ng-container *ngIf="course.words?.length; else noWordsAssociated">
				<span *ngFor="let word of course.words" class="mx-1 text-primary">
					{{ word }}
				</span>
			</ng-container>

			<ng-template #noWordsAssociated>
				<small class="italic py-2">Aucun mot associé à cette semaine</small>
			</ng-template>

			<hr class="my-3" />

			<div class="flex items-center justify-between">
				<h3 class="text-sm italic !mb-1">Liste des fichiers</h3>
				<app-icon
					class="cursor-pointer !mx-0 mr-4 mt-1"
					color="accent"
					matTooltip="Télécharger tout les pdfs">
					download
				</app-icon>
			</div>
			<mat-selection-list #files [multiple]="false">
				<mat-list-option
					*ngFor="let file of filesAvailable"
					[value]="file.path"
					[selected]="file === filesAvailable[0]">
					{{ file.name }}
				</mat-list-option>
			</mat-selection-list>
			<span class="flex-1"></span>
		</mat-drawer>

		<app-file-viewer
			*ngIf="
				files.selectedOptions.selected[0] ?? filesAvailable[0] as selectedFile
			"
			[fileName]="[course.order + 1, selectedFile.value].join('/')" />
	</mat-drawer-container>
	<ng-template #unauthorizedLesson>
		<h2 class="text-center text-white">Accès réservé aux abonnés !</h2>
		<div class="max-w-md mx-auto">
			<img src="assets/img/access-denied.gif" alt="Accès non autorisé" />
			<p class="text-lg text-primary text-balance text-center">
				Cette leçon n'est accessible uniquement pour les membres abonnés! Pour
				accéder au reste du contenu, abonnez-vous !
			</p>
			<app-button
				type="raised"
				class="mt-3"
				label="Voir l'abonnement"
				href="/app/subscription" />
		</div>
	</ng-template>
</ng-container>
