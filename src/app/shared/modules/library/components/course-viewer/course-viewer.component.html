@if (course) {
	<mat-drawer-container class="w-full h-full" autosize>
		<mat-drawer
			#drawer
			class="!flex flex-col justify-start items-start px-4 w-72"
			[mode]="platform.isMobileView() ? 'over' : 'side'"
			opened>
			<h2 class="my-2 text-2xl" [style]="'color:' + course.color">
				Semaine N°{{ (course.order + 1).toFixed() }}
				<app-icon></app-icon>
			</h2>
			<!-- Course States -->
			@if (course.order < currentUserLesson) {
				<div class="flex justify-start items-center gap-3 mb-2">
					<span
						class="bg-green-700 px-2 py-1 rounded-md w-fit text-sm text-white italic">
						Leçon terminée
					</span>
					<app-icon
						class="!mx-0 cursor-pointer"
						color="accent"
						[class]="{'cursor-wait': loading}"
						(click)="setCurrentLesson(course.order)"
						matTooltip="Revenir à cette leçon">
						skip_previous
					</app-icon>
				</div>
			} @else {
				@if (course.order > currentUserLesson) {
					<div class="flex justify-start items-center gap-3 mb-2">
						<span
							matTooltip="Vous êtes actuellement dans une leçon précédente à celle-ci"
							class="bg-slate-300 px-2 py-1 rounded-md w-fit text-gray-700 text-sm italic">
							Leçon en attente
						</span>
						<app-icon
							class="!mx-0 cursor-pointer"
							color="accent"
							[class]="{'cursor-wait': loading}"
							(click)="setCurrentLesson(course.order)"
							matTooltip="Passer à cette leçon">
							skip_next
						</app-icon>
					</div>
				} @else {
					<div class="flex justify-start items-center gap-3 mb-2">
						<span
							class="bg-primary px-2 py-1 rounded-md w-fit text-sm text-white italic">
							Leçon en cours
						</span>
						<app-icon
							class="!mx-0 cursor-pointer"
							[class]="{'cursor-wait': loading}"
							(click)="setCurrentLesson(course.order + 1)"
							matTooltip="Marquer comme terminée">
							check
						</app-icon>
					</div>
				}
			}
			<hr class="mt-3 mb-6" />
			<h3 class="!mb-3 text-sm italic">Graphème(s)</h3>
			<div class="flex flex-wrap gap-3 text-sm" style="max-width: 14rem">
				@for (phoneme of course.phonemes; track phoneme) {
					<span
						class="flex items-center bg-primary px-2 py-1 rounded-md h-8 text-white">
						@if (phoneme.endOfWord) {
							<span>-</span>
						}
						{{ phoneme.name | uppercase }}
						@if (phoneme.sounds; as sounds) {
							@for (sound of sounds; track sound) {
								<span class="px-1 text-xs"> [{{ sound }}] </span>
							}
						}
						@if (phoneme.info) {
							<span class="pl-1 text-sm">({{ phoneme.info }})</span>
						}
					</span>
				}
			</div>
			<hr class="mt-3 mb-6" />
			<div class="flex justify-between items-center">
				<h3 class="!mb-1 text-sm italic">Liste des fichiers</h3>
			</div>
			<mat-list #files role="list">
				@for (file of filesAvailable; track file) {
					<mat-list-item class="!px-0">
						<div class="flex justify-between items-center gap-2">
							<div
								class="flex flex-1 justify-between items-center gap-3 hover:bg-slate-200 px-3 py-4 rounded-lg text-sm cursor-pointer"
								[class]="{
									'cursor-wait': loading,
									'active': selectedFile?.name === file.name
								}"
								(click)="
									(loading || selectedFile?.name !== file.name) &&
										setCurrentFile(file)
								">
								<span>{{ file.name }}</span>
								<app-icon
									class="!mx-0"
									[color]="
										selectedFile?.name !== file.name ? 'primary' : 'disabled'
									">
									visibility
								</app-icon>
							</div>
							<app-button
								[disabled]="loading"
								class="!w-fit"
								[class]="{'cursor-wait': loading}"
								(click)="downloadFile(file)"
								type="icon">
								<app-icon color="accent">download</app-icon>
							</app-button>
						</div>
					</mat-list-item>
				}
			</mat-list>
			<!-- <app-button
			class="mx-auto"
			type="stroked"
			(click)="downloadCourse()"
			color="accent">
			Tout télécharger
		</app-button> -->
			<span class="flex-1"></span>
		</mat-drawer>
		<app-file-viewer
			(fileLoaded)="fileLoaded()"
			[fileName]="[course.order + 1, 'files', selectedFile?.path].join('/')" />
	</mat-drawer-container>
}
