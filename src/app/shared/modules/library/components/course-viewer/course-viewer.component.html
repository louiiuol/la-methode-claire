<ng-container *ngIf="course">
	<mat-drawer-container
		class="h-full w-full"
		autosize
		*ngIf="course.order < 3 || hasValidSubscription; else unauthorizedLesson">
		<mat-drawer
			#drawer
			class="w-60 p-4 !flex flex-col justify-start items-start"
			[mode]="platform.isMobileView() ? 'over' : 'side'"
			opened>
			<h2 class="text-2xl" [style]="'color:' + course.color">
				Semaine N°{{ (course.order + 1).toFixed() }}
			</h2>
			<mat-chip-listbox class="mb-2" aria-label="Phonèmes associés">
				<mat-chip-option
					*ngFor="let phoneme of course.phonemes"
					selectable="false"
					color="primary">
					{{ phoneme.name }}
				</mat-chip-option>
			</mat-chip-listbox>
			<app-button
				*ngIf="course.order >= currentUserLesson; else completedCourse"
				type="raised"
				color="primary"
				(click)="setCurrentLesson(course.order + 1)"
				label="Marquer comme terminée" />
			<ng-template #completedCourse>
				<app-message summary="Cette leçon est terminée" severity="note" />
				<app-button
					type="stroked"
					color="primary"
					label="Revenir à cette leçon"
					(click)="setCurrentLesson(course.order)" />
			</ng-template>

			<hr class="my-3" />

			<h3 class="text-xl !mb-1">Liste des mots</h3>
			<mat-chip-listbox
				*ngIf="course.words?.length; else noWordsAssociated"
				class="mb-2"
				aria-label="Mots associés">
				<mat-chip-option
					*ngFor="let word of course.words"
					selectable="false"
					color="primary">
					{{ word }}
				</mat-chip-option>
			</mat-chip-listbox>
			<ng-template #noWordsAssociated>
				<app-message
					[showIcon]="false"
					summary="Aucun mot associé à cette semaine"
					severity="warn" />
			</ng-template>
			<hr class="mb-6" />
			<h3 class="text-xl">Liste des fichiers</h3>
			<mat-selection-list #files [multiple]="false">
				<mat-list-option
					*ngFor="let file of filesAvailable"
					[value]="file.path"
					[selected]="file === filesAvailable[0]">
					{{ file.name }}
				</mat-list-option>
			</mat-selection-list>
			<span class="flex-1"></span>
		</mat-drawer>
		<app-file-viewer
			*ngIf="
				files.selectedOptions.selected[0] ?? filesAvailable[0] as selectedFile
			"
			[fileName]="[course.order + 1, selectedFile.value].join('/')" />
	</mat-drawer-container>
	<ng-template #unauthorizedLesson>
		<h2 class="text-center text-white">Accès réservé aux abonnés !</h2>
		<div class="max-w-md mx-auto">
			<img src="assets/img/access-denied.gif" alt="Accès non autorisé" />
			<p class="text-lg text-primary text-balance text-center">
				Cette leçon n'est accessible uniquement pour les membres abonnés! Pour
				accéder au reste du contenu, abonnez-vous !
			</p>
			<app-button
				type="raised"
				class="mt-3"
				label="Voir l'abonnement"
				href="/app/subscription" />
		</div>
	</ng-template>
</ng-container>
